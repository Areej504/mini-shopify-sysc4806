<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${shop.name}"> Personalized Store </title>
    <style>
        /* General Reset and Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: #333;
        }

        /* Black Top Mini-Shopify Banner */
        .mini-shopify-banner {
            background-color: #000;
            color: #ffffff;
            padding: 10px 20px;
            font-size: 1em;
            display: flex;
            align-items: center;
            box-sizing: border-box;
            width: 100%;
        }

        .mini-shopify-banner .cart-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        /* Green Top Banner */
        .top-banner {
            background-color: #2e7d32; /* Match the green theme */
            color: #ffffff;
            padding: 15px;
            text-align: left;
            font-size: 1.5em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Layout */
        .container {
            display: flex;
            flex-grow: 1; /* Fill the available space */
        }

        /* Left Panel */
        .left-panel {
            width: 200px;
            background-color: #fbfffb;
            padding: 20px;
            box-shadow: 2px 0px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .left-panel button {
            padding: 10px;
            font-size: 1em;
            cursor: pointer;
            background-color: #1b5e20; /* Darker green for buttons */
            color: #ffffff;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .left-panel button:hover {
            background-color: #144d16; /* Darker on hover */
        }

        /* Main Content */
        .main-content {
            flex-grow: 1; /* Fill the remaining space */
            background-color: #f5f5f5; /* Light background for content */
            padding: 20px;
        }

        /* Product Card */
        .product-card {
            border: 1px solid #e0e0e0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .product-card h3 {
            margin: 0;
            font-size: 1.2em;
            color: #1b5e20;
        }

        .product-card .price {
            font-weight: bold;
            color: #333;
        }

        .product-card .productId,
        .product-card .description,
        .product-card .inventory {
            color: #555;
            font-size: 0.9em;
        }

        .product-card .category,
        .product-card .promotionType {
            color: #777; /* Slightly lighter color to differentiate */
            font-size: 0.9em; /* Match description size */
            margin-top: 8px; /* Add spacing for consistency */
        }

        .product-card .category::before {
            content: "Category: ";
            font-weight: bold;
            color: #333;
        }

        .product-card .promotionType::before {
            content: "Promotion: ";
            font-weight: bold;
            color: #333;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #ffffff;
            padding: 50px;
            border-radius: 10px;
            width: 50%;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .modal-content h3 {
            margin-top: 0;
            color: #333;
        }

        .modal-content button {
            padding: 10px 20px;
            margin-top: 20px;
            font-size: 1em;
            background-color: #1b5e20;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Input Fields */
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }

        .form-row {
            display: flex;
            gap: 15px; /* Space between fields in the same row */
        }

        .form-group label {
            font-size: 0.9em;
            margin-bottom: 4px;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 6px;
            font-size: 0.9em;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 100%;
            box-sizing: border-box;
        }

        .form-group.half-width {
            flex: 1;
        }

        /* Button Row */
        .button-row {
            display: flex;
            justify-content: flex-end;
            gap: 10px; /* Space between the buttons */
            margin-top: 20px; /* Space above the buttons */
        }

        .button-row button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #1b5e20;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .button-row button:hover {
            background-color: #144d16;
        }


    </style>
</head>
<body>

<!-- Black Mini-Shopify Banner -->
<div class="mini-shopify-banner">
    <span class="cart-icon">ðŸ›’</span>
    <span>Mini-Shopify</span>
</div>

<!-- Green Top Banner -->
<div class="top-banner" th:text="${shop.name}">Personalized Store</div>

<div class="container">
    <!-- Left Panel -->
    <div class="left-panel">
        <button onclick="openModal('addProductModal')">Add Product</button>
        <button onclick="openModal('removeProductModal')">Remove Product</button>
        <button onclick="openModal('setPromotionModal')">Set Promotion</button>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <h2>Product List</h2>
        <div th:each="product : ${products}" th:id="'product-' + ${product.productId}" class="product-card">
            <p class="productId" th:text="'Product ID: ' + ${product.productId}">ProductId</p>
            <h3 th:text="${product.productName}">Product Name</h3>
            <p class="price" th:text="${'Price: $' + product.price}">Price</p>
            <p class="inventory" th:text="'Inventory: ' + ${product.inventory}">Inventory</p>
            <p class="description" th:text="'Description: ' + ${product.description}">Description</p>
            <p class="category" th:text="${product.category}">Category</p>
            <p class="promotionType" th:text="${product.promotionType}">Promotion</p>
        </div>

    </div>
</div>

<!-- Modals -->
<div id="addProductModal" class="modal">
    <div class="modal-content">
        <h3>Add Product</h3>
        <!-- Form to add product details -->
        <form id="addProductForm" th:action="@{/merchantShop/{shopId}(shopId=${shop.shopId})}" th:object="${product}" method="post" onsubmit="submitProductForm(event)">
            <!-- First Row: Product Name and Price -->
            <div class="form-row">
                <div class="form-group half-width">
                    <label for="productName">Product Name:</label>
                    <input type="text" id="productName" th:field="*{productName}" required>
                </div>
                <div class="form-group half-width">
                    <label for="price">Price:</label>
                    <input type="number" id="price" name="price" th:field="*{price}" min="0" step="0.01" required>
                </div>
            </div>

            <!-- Second Row: Inventory and Category -->
            <div class="form-row">
                <div class="form-group half-width">
                    <label for="inventory">Inventory:</label>
                    <input type="number" id="inventory" name="inventory" th:field="*{inventory}" min="0" step="1" required>
                </div>
                <div class="form-group half-width">
                    <label for="category-select-[[${product.productId}]]">Category:</label>
                    <select id="category-select-[[${product.productId}]]" name="category" th:field="*{category}">
                        <option value="" disabled selected>Select a category</option>
                        <option th:each="category : ${categories}" th:value="${category}" th:text="${category}"></option>
                    </select>
                </div>
            </div>

            <!-- Third Row: Promotion and Description -->
            <div class="form-row">
                <div class="form-group half-width">
                    <label for="promotion-select-[[${product.productId}]]">Promotion:</label>
                    <select id="promotion-select-[[${product.productId}]]" name="promotionType" th:field="*{promotionType}">
                        <option value="" disabled selected>Select a promotion</option>
                        <option th:each="promotion : ${promotions}" th:value="${promotion}" th:text="${promotion}"></option>
                    </select>
                </div>
                <div class="form-group half-width">
                    <label for="description">Description:</label>
                    <textarea id="description" name="description" th:field="*{description}" rows="3" required></textarea>
                </div>
            </div>

            <!-- Button Row: Add Product and Close Buttons -->
            <div class="button-row">
                <button type="submit">Add Product</button>
                <button type="button" onclick="closeModal('addProductModal')">Close</button>
            </div>
        </form>
    </div>
</div>


<div id="setPromotionModal" class="modal">
    <div class="modal-content">
        <h3>Set Promotion</h3>
        <p>Enter details to set a promotion.</p>
        <button onclick="closeModal('setPromotionModal')">Close</button>
    </div>
</div>
<div id="removeProductModal" class="modal">
    <div class="modal-content">
        <h3>Remove Product</h3>
        <p>Enter the product ID to remove an existing product.</p>

        <!-- Input field to enter Product ID -->
        <div class="form-group">
            <input type="text" id="deleteProductId" placeholder="Product ID" required>
        </div>

        <!-- Button to confirm deletion -->
        <button th:onclick="'confirmDeleteProduct(' + ${shop.shopId} + ')'" onclick="confirmDeleteProduct()">Remove Product</button>
        <button onclick="closeModal('removeProductModal')">Close</button>
    </div>
</div>


<script th:inline="javascript">
    // Embed the shopId from Thymeleaf
    const shopId = /*[[${shop.shopId}]]*/ 0;

    //SPA function to re-load the product list every time a change is made
    // function loadProductList() {
    //     fetch('/merchantShop/{shopId}')
    //         .then(response => response.text())
    //         .then(data => {
    //             document.getElementById('productList').innerHTML = data;
    //         })
    //         .catch(error => console.error('Error loading products:', error));
    // }

    //  load product list when the page loads
    // window.onload = loadProductList;

    // JavaScript functions to open and close modals
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    function submitAddProductForm(event) {
        event.preventDefault(); // Prevent default form submission
        const form = document.getElementById('addProductForm');
        const formData = new FormData(form);

        fetch('/merchantShop/{shopId}', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    closeModal('addProductModal'); // Close the modal
                    // loadProductList(); // Reload the product list
                } else {
                    console.error('Error adding product');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function confirmDeleteProduct(shopId) {
        const productId = document.getElementById('deleteProductId').value;

        if (!productId) {
            alert("Please enter a product ID.");
            return;
        }

        if (!confirm("Are you sure you want to remove this product?")) return;

        // Log URL for debugging
        const deleteUrl = `/merchantShop/${shopId}/${productId}`;
        console.log(`Deleting product with URL: ${deleteUrl}`);

        // Send delete request to backend
        fetch(deleteUrl, {
            method: 'DELETE',
        })
            .then(response => {
                if (response.ok) {
                    // Remove the product card from the DOM
                    const productElement = document.getElementById(`product-${productId}`);
                    if (productElement) {
                        productElement.remove(); // Remove the product block
                    }
                    closeModal('removeProductModal'); // Close the modal
                    document.getElementById('deleteProductId').value = ''; // Clear input
                } else {
                    console.error(`Error removing product: ${response.statusText}`);
                    alert("Failed to delete the product. Please try again.");
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                alert("An error occurred while deleting the product.");
            });
    }

    function deleteProduct(shopId, productId) {
        if (!confirm("Are you sure you want to remove this product?")) return;

        fetch(`/merchantShop/${shopId}/${productId}`, {
            method: 'DELETE',
        })
            .then(response => {
                if (response.ok) {
                    document.getElementById(`product-${productId}`).remove(); // Remove the product card
                    closeModal('removeProductModal'); // Close the modal
                } else {
                    console.error('Error removing product');
                    alert("Product not found or could not be removed.");
                }
            })
            .catch(error => console.error('Error:', error));
    }

</script>

</body>
</html>